<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>究極の2択 性格ゲーム（新年会・宣伝SP）</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{
    margin:0; background:#111; color:#f7f7f7;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    display:flex; justify-content:center; align-items:center; min-height:100vh;
    overflow-x: hidden;
  }
  #confetti-canvas {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 999;
  }
  .card{
    background:#181818; border:1px solid #444; border-radius:16px;
    padding:22px 20px; max-width:560px; width:95%;
    box-shadow:0 0 25px rgba(0,0,0,.6); box-sizing:border-box; text-align: center;
    position: relative; z-index: 10;
    animation: fadeIn 0.5s ease-out;
  }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  
  h1{ margin:.2em 0 .5em; font-size:1.4rem; letter-spacing:.02em; }
  .progress{ color:#aaa; font-size:.8rem; margin-bottom:.35em; text-align: left; }
  .question{ margin:1em 0; font-size:1.1rem; line-height:1.5; font-weight:700; min-height: 3em; display: flex; align-items: center; justify-content: center;}
  .choices{ display:flex; flex-direction:column; gap:12px; margin:16px 0; }
  
  .btn{
    border:none; border-radius:999px; padding:15px 18px;
    font-size:1rem; cursor:pointer; transition: transform 0.1s, background 0.2s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn:active { transform: scale(0.96); }
  .choice{ background:#252525; color:#fff; border:1px solid #444; text-align:left; line-height:1.4; }
  .choice.selectedA{ border-color:#f5b642; background:rgba(245,182,66,.15); }
  .choice.selectedB{ border-color:#e50914; background:rgba(229,9,20,.15); }

  .main{ background:linear-gradient(135deg,#e50914,#f5b642); color:#111; font-weight:700; width:100%; }
  /* LINEボタンのスタイルを少し変更して目立たせます */
  .line-btn{ background:#06C755; color:#fff; font-weight:700; width:100%; margin-bottom: 15px; display: block; text-decoration: none; text-align: center; line-height: 1.2; padding: 18px;}
  .sub{ background:#2a2a2a; color:#fff; border:1px solid #444; flex:1; }
  .danger{ background:#e50914; color:#fff; font-weight:700; width:100%; }
  .nav{ display:flex; gap:8px; margin-top:10px; }
  
  img.hero{ width:100%; max-width:280px; display:block; margin:10px auto; border-radius:10px; }
  .highlight{ color:#f5b642; font-weight:700; }
  .small{ font-size:.8rem; color:#ccc; margin-top: 10px; }
  
  /* 円形チャート用スタイル */
  .chart-container { position: relative; width: 180px; height: 180px; margin: 15px auto; }
  .chart-svg { transform: rotate(-90deg); }
  .chart-bg { fill: none; stroke: #333; stroke-width: 15; }
  .chart-bar { fill: none; stroke: #f5b642; stroke-width: 15; stroke-linecap: round; transition: stroke-dasharray 1s ease-out; }
  .chart-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; font-size: 1.2rem; }
</style>
</head>

<body>
<canvas id="confetti-canvas"></canvas>
<div class="card" id="app"></div>

<script>
/* =========================================================
   基本設定 & LINEリンク
========================================================= */
const STICKER_URL = "https://line.me/S/shop/sticker/author/5729491";
const rainyTypeLabel = "作者：Rainy（タイプ5）";

const dogImages = {
  1: "img/dog_type01.png", 2: "img/dog_type02.png", 3: "img/dog_type03.png",
  4: "img/dog_type04.png", 5: "img/dog_type05.png", 6: "img/dog_type06.png",
  7: "img/dog_type07.png", 8: "img/dog_type08.png", 9: "img/dog_type09.png"
};
function getDogImg(t){ return dogImages[t] || dogImages[5]; }

/* =========================================================
   データ（2択32問 & エニア18問）
========================================================= */
// ... (設問データは前回のものをそのまま利用します)
const questions32 = [
  {q:"嫌われない人生 vs なめられない人生",A:"嫌われない",B:"なめられない"},
  {q:"ずっと謝り続ける vs ずっと言い訳し続ける",A:"謝り続ける",B:"言い訳し続ける"},
  {q:"一生気まずい沈黙 vs 一生浅い雑談",A:"気まずい沈黙",B:"浅い雑談"},
  {q:"毎日上司に詰められる vs 毎日部下に裏切られる",A:"上司に詰められる",B:"部下に裏切られる"},
  {q:"一生頼れない vs 一生頼られすぎる",A:"頼れない",B:"頼られすぎる"},
  {q:"一生本音しか言えない vs 一生ウソしか言えない",A:"本音しか言えない",B:"ウソしか言えない"},
  {q:"一生予定が狂う vs 一生予定通りで退屈",A:"予定が狂う",B:"予定通りで退屈"},
  {q:"一生誤解され続ける vs 一生期待され続ける",A:"誤解され続ける",B:"期待され続ける"},
  {q:"一生選択を迫られる vs 一生選択肢がない",A:"選択を迫られる",B:"選択肢がない"},
  {q:"一生相談されない vs 一生相談され続ける",A:"相談されない",B:"相談され続ける"},
  {q:"一生評価されない努力 vs 一生評価される実力不足",A:"評価されない努力",B:"評価される実力不足"},
  {q:"一生予定を守らされる vs 一生予定を守られない",A:"守らされる",B:"守られない"},
  {q:"一生人に合わせ続ける vs 一生人に合わせてもらう",A:"合わせ続ける",B:"合わせてもらう"},
  {q:"一生安心できない成功 vs 一生安心だけの失敗",A:"安心できない成功",B:"安心だけの失敗"},
  {q:"一生注目され続ける vs 一生存在感ゼロ",A:"注目され続ける",B:"存在感ゼロ"},
  {q:"一生誰かに依存される vs 一生誰にも頼られない",A:"誰かに依存される",B:"誰にも頼られない"},
  {q:"一生安心 vs 一生ワクワク",A:"安心",B:"ワクワク"},
  {q:"一生理解される vs 一生自由でいられる",A:"理解される",B:"自由でいられる"},
  {q:"一生お金に困らない vs 一生時間に追われない",A:"お金に困らない",B:"時間に追われない"},
  {q:"称賛される天才 vs 愛される凡人",A:"称賛される天才",B:"愛される凡人"},
  {q:"一生自信がある vs 一生不安がない",A:"自信がある",B:"不安がない"},
  {q:"一生心が穏やか vs 一生感動が多い",A:"心が穏やか",B:"感動が多い"},
  {q:"一生好きなことだけ vs 一生得意なことだけ",A:"好きなことだけ",B:"得意なことだけ"},
  {q:"一生ひとり時間たっぷり vs 一生仲間と一緒",A:"ひとり時間",B:"仲間と一緒"},
  {q:"一生今のままでOKと言われる vs 一生もっと期待される",A:"今のままでOK",B:"もっと期待される"},
  {q:"一生失敗しない vs 一生後悔しない",A:"失敗しない",B:"後悔しない"},
  {q:"一生誰かの一番 vs 一生みんなに好かれる",A:"誰かの一番",B:"みんなに好かれる"},
  {q:"一生自分を信じられる vs 一生人を信じられる",A:"自分を信じられる",B:"人を信じられる"},
  {q:"一生必要とされる vs 一生尊敬される",A:"必要とされる",B:"尊敬される"},
  {q:"一生穏やかな日常 vs 一生忘れられない瞬間",A:"穏やかな日常",B:"忘れられない瞬間"},
  {q:"一生選ばれる側 vs 一生選ぶ側",A:"選ばれる側",B:"選ぶ側"},
  {q:"一生自分を好きでいられる vs 一生愛され続ける",A:"自分を好きでいられる",B:"愛され続ける"}
];
const rainyAnswers32 = ["B","A","A","A","A","A","B","A","A","A","A","A","A","A","B","B","A","B","B","A","B","A","A","A","A","B","B","B","B","A","B","A"];
const ennea18 = [
  {q:"ミスを見つけたとき、まず出る反応は？",A:"正しく直したくなる", B:"波風を立てずに流したくなる",Atypes:[1], Btypes:[9]},
  {q:"誰かが落ち込んでる。あなたの最初の動きは？",A:"手伝えることを探して動く", B:"距離を保ちつつ状況を分析する",Atypes:[2], Btypes:[5]},
  {q:"結果が必要な場面。あなたが選ぶのは？",A:"成果を出して評価を取りにいく", B:"自分らしさ・世界観を守る",Atypes:[3], Btypes:[4]},
  {q:"集団の中でのあなたは？",A:"空気を整えて“普通に”合わせる", B:"あえて独自路線でいく",Atypes:[9,6], Btypes:[4,7]},
  {q:"不安なときのクセは？",A:"最悪パターンを想定して備える", B:"とにかく動いて切り抜ける",Atypes:[6], Btypes:[8]},
  {q:"揉め事が起きたとき",A:"白黒つけて前に進める", B:"みんなの妥協点を探す",Atypes:[8], Btypes:[9]},
  {q:"休日の理想は？",A:"予定を詰めて楽しいこと全部やる", B:"整えて、質を上げて満足する",Atypes:[7], Btypes:[1,5]},
  {q:"人に頼まれたとき",A:"つい引き受けがち（期待に応えたい）", B:"条件を確認してから決める",Atypes:[2,9], Btypes:[8,5]},
  {q:"評価されると嬉しいのは？",A:"すごいね！結果出したね！", B:"わかってるね…深いね…",Atypes:[3], Btypes:[5,4]},
  {q:"初対面が多い場",A:"まず周りを観察して安全確認", B:"とりあえず話しかけて場を作る",Atypes:[6,5], Btypes:[7,3]},
  {q:"ルールが曖昧なとき",A:"こうあるべき基準を作る", B:"状況に合わせて柔軟にいく",Atypes:[1], Btypes:[9,7]},
  {q:"気づいたらやってること",A:"人の役に立つ行動（世話/フォロー）", B:"効率化・省力化・仕組み化",Atypes:[2], Btypes:[5,3]},
  {q:"怒りが出る瞬間",A:"筋が通ってない/ズルい", B:"支配される/舐められる",Atypes:[1], Btypes:[8]},
  {q:"落ち込んだとき",A:"自分の世界に潜って感情を味わう", B:"とにかく前向きイベントで上書き",Atypes:[4], Btypes:[7]},
  {q:"責任が重いとき",A:"ちゃんとやる（完璧寄り）", B:"守りを固める（確認/保険）",Atypes:[1,3], Btypes:[6]},
  {q:"人間関係でよく言われがち",A:"優しい/合わせてくれる", B:"クール/ドライ/一線引く",Atypes:[9,2], Btypes:[5,8]},
  {q:"“自分らしさ”で譲れないのは？",A:"センス・個性・意味", B:"結果・実利・効率",Atypes:[4], Btypes:[3,5]},
  {q:"疲れているときの回復法",A:"一人になって充電", B:"誰かと話して回復",Atypes:[5,4], Btypes:[2,7,9]}
];
const typeLabel = {1:"タイプ1：改革タイプ", 2:"タイプ2：援助タイプ", 3:"タイプ3：達成タイプ", 4:"タイプ4：個性タイプ", 5:"タイプ5：分析タイプ", 6:"タイプ6：安全タイプ", 7:"タイプ7：熱中タイプ", 8:"タイプ8：挑戦タイプ", 9:"タイプ9：平和タイプ"};
const typeOneLiner = {1:"『正しさ』に命をかける。脳内に監査部が常駐。",2:"人の役に立つと元気。世話焼きが発動中。",3:"勝ち筋を見つけて最短で取りにいく。",4:"“私だけの世界”がある。情緒が武器。",5:"情報を食べて生きる。静かに全部見てる。",6:"危機管理がプロ級。安心設計の守り神。",7:"楽しさ最優先。ワクワク嗅覚が最強。",8:"強くて頼れる。守るために前に出るボス。",9:"場を和ませる天才。争いを丸く収める。"};

/* =========================================================
   メインロジック
========================================================= */
let index32 = 0; let ans32 = [];
let index18 = 0; let ans18 = [];

function renderStart(){
  stopConfetti();
  app.innerHTML = `
    <h1>究極の2択 性格ゲーム</h1>
    <img class="hero" src="${getDogImg(5)}" alt="タイプ5">
    <p class="subtitle">新年会を盛り上げる「思考シンクロ診断」<br>あなたの考えは作者Rainyと一致するか？</p>
    <button class="btn main" onclick="startTwoChoice()">ゲーム開始</button>
  `;
}

function startTwoChoice(){ index32 = 0; ans32 = []; renderQuestion32(); }

function next32() {
  if (index32 === 15) { renderTransition(); return; }
  index32++;
  if (index32 >= questions32.length) { renderResult32(); } else { renderQuestion32(); }
}
function prev32() {
  if (index32 === 0) { renderStart(); return; }
  if (index32 === 16) { renderTransition(); return; }
  index32--; renderQuestion32();
}

function renderQuestion32(){
  const q = questions32[index32]; const a = ans32[index32];
  const mode = index32 < 16 ? "地獄" : "天国";
  app.innerHTML = `
    <div class="progress">Q${index32 + 1} / 32 [${mode}]</div>
    <div class="question">${escapeHtml(q.q)}</div>
    <div class="choices">
      <button class="btn choice ${a === 'A' ? 'selectedA' : ''}" onclick="ans32[index32]='A';renderQuestion32()">${escapeHtml(q.A)}</button>
      <button class="btn choice ${a === 'B' ? 'selectedB' : ''}" onclick="ans32[index32]='B';renderQuestion32()">${escapeHtml(q.B)}</button>
    </div>
    <div class="nav">
      <button class="btn sub" onclick="prev32()">戻る</button>
      <button class="btn danger" onclick="next32()" ${!a?'disabled':''}>${index32===31?'結果へ':'次へ'}</button>
    </div>
  `;
}

function renderTransition(){
  app.innerHTML = `
    <h1>地獄モード終了！</h1>
    <img class="hero" src="img/transition_hell_to_heaven.png" alt="天国へ">
    <p class="subtitle">ここからは「究極の幸せ」を選ぶ<br><strong>天国モード</strong>突入です！</p>
    <button class="btn main" onclick="index32=16;renderQuestion32()">天国へ進む →</button>
  `;
}

/* =========================================================
   2択結果表示（修正：途中のLINEリンク削除）
========================================================= */
function renderResult32(){
  let rainy = 0; ans32.forEach((a,i)=>{ if(a === rainyAnswers32[i]) rainy++; });
  const percent = Math.round((rainy / 32) * 100);
  
  let status = "普通の人"; let color = "#aaa";
  if (rainy >= 26) { status = "景品対象！ソウルメイト"; color = "#f5b642"; startConfetti(); }
  else if (rainy <= 8) { status = "罰ゲーム対象！異星人"; color = "#e50914"; }

  app.innerHTML = `
    <h1 style="color:${color}">${status}</h1>
    <div class="chart-container">
      <svg class="chart-svg" width="180" height="180">
        <circle class="chart-bg" cx="90" cy="90" r="75"></circle>
        <circle class="chart-bar" cx="90" cy="90" r="75" style="stroke-dasharray: ${471 * (percent/100)} 471; stroke: ${color}"></circle>
      </svg>
      <div class="chart-text">${rainy} pt</div>
    </div>
    <p class="subtitle">Rainyとのシンクロ率：<strong>${percent}%</strong></p>
    
    <div class="nav"><button class="btn main" onclick="startEnnea18()">エニア判定（18問）へ →</button></div>
    <div class="nav"><button class="btn sub" onclick="renderStart()">TOPへ戻る</button></div>
  `;
}

/* =========================================================
   エニア18問ロジック
========================================================= */
function startEnnea18(){ index18=0; ans18=new Array(18).fill(null); renderQuestion18(); }
function renderQuestion18(){
  const item = ennea18[index18]; const a = ans18[index18];
  app.innerHTML = `
    <div class="progress">エニア Q${index18 + 1} / 18</div>
    <h1>エニア判定</h1>
    <div class="question">${escapeHtml(item.q)}</div>
    <div class="choices">
      <button class="btn choice ${a==='A'?'selectedA':''}" onclick="ans18[index18]='A';renderQuestion18()">${escapeHtml(item.A)}</button>
      <button class="btn choice ${a==='B'?'selectedB':''}" onclick="ans18[index18]='B';renderQuestion18()">${escapeHtml(item.B)}</button>
    </div>
    <div class="nav">
      <button class="btn sub" onclick="index18===0?renderResult32():(index18--,renderQuestion18())">戻る</button>
      <button class="btn danger" onclick="index18===17?renderResult18():(index18++,renderQuestion18())" ${!a?'disabled':''}>次へ</button>
    </div>
  `;
}

/* =========================================================
   エニア結果表示（修正：途中のLINEリンク削除）
========================================================= */
function renderResult18(){
  const score = {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
  ans18.forEach((p, i)=>{ const types = (p === "A") ? ennea18[i].Atypes : ennea18[i].Btypes; types.forEach(t => score[t]++); });
  const ranked = Object.keys(score).map(k=>({t:Number(k),p:score[k]})).sort((a,b)=>b.p-a.p);
  const top = ranked[0].t;

  app.innerHTML = `
    <h1>判定結果：${escapeHtml(typeLabel[top])}</h1>
    <img class="hero" src="${getDogImg(top)}">
    <div class="subtitle"><strong>${escapeHtml(typeOneLiner[top])}</strong></div>
    <hr class="sep">
    <div class="small">上位3タイプ：${ranked.slice(0,3).map(r=>`${r.t}(${r.p}点)`).join(', ')}</div>
    <div class="nav"><button class="btn danger" onclick="renderPenalty()">罰ゲーム発表へ →</button></div>
  `;
}

/* =========================================================
   罰ゲーム画面（修正：最後にLINEリンクボタンを設置）
========================================================= */
function renderPenalty(){
  stopConfetti();
  // 「タイプ5崩壊」の画像を、謎めいた「機密ミッション」の象徴として使用
  app.innerHTML = `
    <h1 style="color:#f5b642; text-shadow: 0 0 15px #f5b642; font-size:1.6rem;">🔒 TOP SECRET MISSION 🔒</h1>
    <img class="hero" src="img/enneagram_penalty_lightstick.png" style="border: 3px solid #f5b642; filter: grayscale(0.5) contrast(1.2);">
    
    <div style="background:rgba(0,0,0,0.8); border:2px solid #f5b642; padding:15px; border-radius:12px; margin:15px 0; text-align:left;">
      <p style="color:#f5b642; font-weight:700; text-align:center; margin-bottom:10px; font-size:1.1rem;">
        【参加条件：徳を積む義務】
      </p>
      
      <p style="color:#fff; font-size:0.9rem; line-height:1.6; margin-bottom:10px;">
        <strong>① 全員共通ミッション：</strong><br>
        本イベントは参加費0円です。その代わり、<strong>お布施（LINEスタンプ購入）</strong>により徳を積むことが全員に義務付けられます。
      </p>
      
      <p style="color:#aaa; font-size:0.9rem; line-height:1.6; margin:0; padding-top:10px; border-top:1px dashed #444;">
        <strong>② 敗者限定ミッション：</strong><br>
        内容は現在<strong>【機密事項】</strong>です。この後、Rainyの口から直接「最下位の方」へ告げられます。
      </p>
    </div>

    <a href="${STICKER_URL}" class="btn line-btn" target="_blank" style="background:linear-gradient(135deg, #f5b642, #b8860b); color:#fff; font-size:1.1rem; padding:18px;">
      🙏 全員：お布施（徳を積む）
    </a>

    <div class="nav" style="margin-top:15px;">
      <button class="btn sub" onclick="renderStart()" style="font-size:0.8rem; opacity:0.5;">TOPへ戻る</button>
    </div>
  `;
}
/* =========================================================
   紙吹雪アニメーション & その他
========================================================= */
const canvas = document.getElementById('confetti-canvas');
const ctx = canvas.getContext('2d');
let particles = [];
function startConfetti() {
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  particles = Array.from({length:100}, () => ({
    x: Math.random()*canvas.width, y: Math.random()*canvas.height - canvas.height,
    r: Math.random()*6+4, d: Math.random()*10,
    color: `hsl(${Math.random()*360}, 100%, 50%)`,
    tilt: Math.random()*10-10
  }));
  animateConfetti();
}
function animateConfetti() {
  if (particles.length === 0) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p => {
    p.y += Math.cos(p.d) + 1 + p.r/2; p.tilt = Math.sin(p.d) * 15;
    ctx.beginPath(); ctx.lineWidth = p.r; ctx.strokeStyle = p.color;
    ctx.moveTo(p.x + p.tilt + p.r/4, p.y); ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r/4);
    ctx.stroke();
    if(p.y > canvas.height) p.y = -20;
  });
  requestAnimationFrame(animateConfetti);
}
function stopConfetti() { particles = []; ctx.clearRect(0,0,canvas.width,canvas.height); }

function escapeHtml(s){ return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }
renderStart();
</script>
</body>
</html>
